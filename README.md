# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### Интерфейс IProduct
Интерфейс описывает объект "товар".

Поля интерфейса: 
`id: string` - уникальный номер каждого товара. 
`description: string` - описание товара.
`src: string` - ссылка на изображение товара.
`alt: string` - описание изображения товара.
`title: string` - название товара.
`category: string` - категория товара.
`price: number | null` - цена товара. Null для "бесценных" товаров, недоступных к покупке.


#### Интерфейс IBuyer
Интерфейс описывает объект "покупатель".

Поля интерфейса: 
`payment: 'card' | 'cash' | ''` - способ оплаты, может быть выбрана оплата картой, наличными либо не выбрано ничего (дефолтное состояние).
`email: string` - email-адрес покупателя.
`phone: string` - телефон покупателя.
`address: string` - адрес покупателя.


### Модели данных

#### Класс ProductCatalog
Класс отвечает за работу с данными, которые формируют каталог товаров.

Конструктор: 
`constructor((products: IProduct[] = []) {})` - конструктор класса принимает массив всех карточек с дефолтным пустым массивом.

Поля класса:
`products: IProduct[]` - массив всех товаров.
`itemsById: Map<string, IProduct>` - мапа, где ключи будут id продуктов, а значения - продуктами.
`selectedId: string | null` - id товара.

Методы:
`set productList(list: IProduct[]): void` - сеттер - сохранение массива товаров полученного в параметрах метода.
`get productsList(): IProduct[]` - геттер - получение массива товаров из модели.
`getProductById(itemId: string): IProduct | undefined` - метод получения товара по его id.
`set selectedProductId(itemId: string | null): void` - сеттер - сохранение товара для подробного отображения.
`get selectedProduct(): IProduct | null` - получение товара для подробного отображения.

#### Класс Cart
Класс отвечает за те товары, которые пользователь выбрал для покупки, - корзину.

Конструктор: 
`constructor((products: IProduct[] = []) {})` - конструктор класса принимает массив всех товаров в корзине.

Поля класса:
`products: IProduct[]` - массив товаров, выбранных для покупки.

Методы:
`set productList(list: IProduct[]): void` - сеттер - сохранение массива товаров полученного в параметрах метода.
`get cartProducts(): IProduct[]`- геттер - получение массива товаров, которые находятся в корзине.
`addProduct(product: IProduct): void` - добавление товара, который был получен в параметре, в массив корзины.
`deleteProduct(productId: string): void` - удаление товара, полученного в параметре, из массива корзины.
`clearCart(): void` - очистка корзины.
`totalPrice(cart: IProduct[]): number` - получение стоимости всех товаров в корзине.
`get cartQuantity(): number` - геттер - получение количества товаров в корзине.
`checkAvailability(productId: string): boolean` - проверка наличия товара в корзине по его id, полученному в параметр метода.

#### Класс Buyer
Класс обрабатывает данные покупателя, которые необходимы для успешного осуществления покупки. 

Конструктор: 
`constructor(buyer: IBuyer): {}` - конструктор принимает данные о покупателе.

Поля класса:
`buyer: IBuyer` - данные о покупателе.

Методы:
`set payment(paymentType: 'card' | 'cash' | '')` - сеттер - сохранение данных о методе оплаты в модели.
`set email(email: string)` - сеттер - сохранение данных об email в модели.
`set phone(phone: string)` - сеттер - сохранение данных о телефоне в модели.
`set address(address: string)` - сеттер - сохранение данных об адресе в модели.
`getBuyerData(): IBuyer` - получение всех данных покупателя.
`clearBuyerData(): void` - очистка данных покупателя.
`buyerDataValidation(): boolean` - валидация данных (проверка всех полей о пользователе на отсутствие пустого значения).


### Слой коммуникации

#### Класс WebLarekApi
Отвечает за работу с Api приложения WebLarek. Наследует класс Api.

Конструктор: 
`constructor(baseUrl: string, options?: RequestInit)` - конструктор вызывает конструктор родителя.

Методы: 
`async fetchProducts(): Promise<IProduct[]>` - отправка запроса на получение массива товаров с сервера.
`async createOrder(orderData: IOrderRequest)` - отправка на сервер создания заказа.

#### Взаимодействие компонентов
Код в файле `main.ts` выполняет роль презентера. Взаимодействие между компонентами осуществляется с помощью брокера событий и обработчиков. В `main.ts` сначала создаются экземпляры всех классов, затем настраивается обработка событий. 

 События, которые генерятся классами моделей данных:
 `cards:loaded` - данные карточек получены с сервера и сохранены в модель данных.
 `card:changed` - изменение выбранного для просмотра товара.
 `basket: changed` - изменение содержимого корзины.
 `buyer:changed` - изменение данных покупателя.
 
 События, которые генерятся классами слоя представления:
 `basket:open` - открытие корзины.
 `card:open` - открытие развёрнутого превью товара.
 `order:start` - начало оформления покупки.
 `card:buy` - нажатие кнопки покупки товара.
 `card:delete` - нажатие кнопки удаления товара из корзины.
 `contacts:open` - переход ко второму этапу оформления товара.
 `order:finished` - завершение заказа.
 `forms:chaned` - изменение данных в формах.

### Данные слоя представления

#### Интерфейс ICounterView
Интерфейс описывает счётчик на иконке корзины хэдера.

Поля интерфейса: 
`counter: number` - счётчик количества товаров в корзине.


#### Интерфейс IGalleryView
Интерфейс описывает каталог карточек на главной странице.

Поля интерфейса: 
`catalog: HTMLElement[]` - галерея принимает массив карточек для их дальнейшего отображения.


#### Интерфейс IModalView
Интерфейс описывает элементы модального окна.

Поля интерфейса: 
`isOpen: boolean` - открыто модальное окно или закрыто.
`content: HTMLElement` - модальное окно принимает HTML-элемент для его дальнейшего отображения.


#### Интерфейс ICardBase
Интерфейс описывает основные элементы отображения карточки.

Поля интерфейса: 
`title: string` - заголовок карточки.
`price: number | null` - цена товара.
`category: string` - категория товара.
`src: string` - url картинки для карточки.
`alt?: string` - атрибут alt для карточки.
`description: string` - описание товара.


<!-- #### Интерфейс ICardCatalog
Расширяет интерфейс ICardBase. Описывает элементы отображения карточки для общего каталога карточек.

Поля интерфейса: 
`category: string` - категория товара.
`src: string` - url картинки для карточки.
`alt?: string` - атрибут alt для карточки.


#### Интерфейс ICardFullPreview
Расширяет интерфейс ICardBase. Описывает элементы подробного отображения карточки.

Поля интерфейса: 
`category: string` - категория товара.
`src: string` - url картинки для карточки.
`alt?: string` - атрибут alt для карточки.
`description: string` - описание товара. -->

<!-- 
#### Интерфейс ICardBasket
Расширяет интерфейс ICardBase. Описывает элементы карточки при отображении в корзине.

Поля интерфейса: 
`item: number` - порядковый номер товара в корзине. -->


#### Интерфейс IBasketView
Описывает элементы отображения корзины.

Поля интерфейса: 
`list: ICardBasket[]` - массив товаров в корзине.
`price: number` - общая стоимость товаров в корзине.


#### Интерфейс ISuccessContentView
Интерфейс описывает элементы "начинки" модального окна, которая появляется у пользователя в завершение покупки.

Поля интерфейса: 
`total: number` - количество списанной валюты (синапсов).


#### Интерфейс IOrderFormView
Интерфейс описывает форму заказа.

Поля интерфейса: 
`isValid: boolean` - проверка валидности формы.
`inputValues: Record<string, string>` - отображение введённых значений.
`errors: Record<string, string>` - отображение возможных ошибок.


### Слой представления

#### Класс HeaderView
Расширяет базовый класс Component с интерфейсом ICounterView. Отвечает за отображение хэдера страницы. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе помимо родительского контейнера находим элементы отображения: кнопка корзины и счётчик количества товаров. Устанавливаем слушатель на клик по значку корзины.

Поля класса:
`counterElement: HTMLElement` - разметка, содержащая информацию о количестве товаров в корзине.
`basketButton: HTMLButtonElement` - кнопка корзины.

Методы:
`set counter(value: number)` - сеттер - количество товаров в корзине, которое отображается в хэдере.


#### Класс GalleryView
Расширяет базовый класс Component с интерфейсом IGalleryView. Отвечает за отображение массива карточек. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе вызываем только конструктор родителя.

Методы:
`set catalog(elements: ICardCatalog[])` - сеттер - устанавливает передачу карточек для отображения.


#### Класс ModalView
Расширяет базовый класс Component с интерфейсом IModalView. Отвечает за отображение модального окна. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим кнопку закрытия и контейнер контента. Устанавливаем слушатели на открытие и закрытие модального окна.

Поля класса:
`closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
`contentElement: HTMLElement` - контейнер для основного контента модального окна.

Методы:
`set content(element: HTMLElement)` - сеттер - устанавливает один из templates для отображения.
`open(): void` - метод открытия модального окна.
`close(): void` - метод закрытия модального окна.


#### Класс CardBaseView
Расширяет базовый класс Component с интерфейсом ICardBase. Отвечает за отображение основных элементов карточек товаров. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим название товара и его цену.

Поля класса:
`cardTitle: HTMLElement` - заголовок карточки.
`cardPrice: HTMLElement` - цена товара.

Методы:
`set title(title: string)` - сеттер - устанавливает отображение заголовка карточки.
`set price(price: number)` - сеттер - устанавливает отображение цены товара.


#### Класс CardGalleryView
Расширяет базовый класс Component с интерфейсом ICardCatalog, наследует класс CardBaseView. Отвечает за отображение карточек в каталоге. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим название категорию и изображение товара.

Поля класса:
`cardCategory: HTMLElement` - категория товара.
`cardImg: HTMLImageElement` - изображение товара.

Методы:
`set category(category: string)` - сеттер - устанавливает категорию товара.
`set src(src: string)` - сеттер - устанавливает url изображения товара.
`set alt(alt: string | undefined)` - сеттер - устанавливает описание изображения товара.


#### Класс CardFullView
Расширяет базовый класс Component с интерфейсом ICardFullPreview, наследует класс CardBaseView. Отвечает за отображение карточек в развёрнутом превью. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим категорию товара, его изображение, описание, а также кнопку добавления товара в корзину. Устанавливаем слушатель на кнопку.

Поля класса:
`cardCategory: HTMLElement` - категория товара.
`cardImg: HTMLImageElement` - изображение товара.
`cardDescription: HTMLElement` - описание товара.
`basketButton: HTMLButtonElement` - кнопка добавления товара в корзину.

Методы:
`set category(category: string)` - сеттер - устанавливает категорию товара.
`set description(description: string)` - сеттер - устанавливает описание товара.
`set src(src: string)` - сеттер - устанавливает url изображения товара.
`set alt(alt: string | undefined)` - сеттер - устанавливает описание изображения товара.


#### Класс CardBasketView
Расширяет базовый класс Component с интерфейсом ICardBasket, наследует класс CardBaseView. Отвечает за отображение карточек в корзине. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим порядковый номер товара, кнопку удаления его из корзины. Устанавливаем слушатель по клику на кнопку удаления.

Поля класса:
`itemNumber: HTMLElement` - порядковый номер товара в корзине.
`deleteButton: HTMLButtonElement` - кнопка удаления товара из корзины.

Методы:
`set counter(value: number)` - сеттер - устанавливает порядковый номер товара в корзине.
`deleteCard(): void` - удаляет разметку карточки из корзины.


#### Класс BasketView
Расширяет базовый класс Component с интерфейсом IBasketView. Отвечает за отображение корзины. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим массив товаров в корзине, кнопку "оформить" и общую сумму заказа. Устанавливаем слушатель на клик по кнопке "оформить".

Поля класса:
`basketList: HTMLUListElement` - массив товаров в корзине.
`basketButton: HTMLButtonElement` - кнопка "оформить" в корзине.
`basketPrice: HTMLElement` - отображение общей суммы заказа.

Методы:
`set list(list: HTMLUListElement)` - сеттер - массив товаров в корзине.
`set price(price: string)` - сеттер - установка общей цены заказа.

#### Класс SuccessView
Расширяет базовый класс Component с интерфейсом ISuccessContentView. Отвечает за финальный баннер, подтверждающий успешный заказ.

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим кнопку и сумму списанной валюты.

Поля класса:
`successDescription: HTMLElement` - описание с указанием списанной суммы.
`successButton: HTMLButtonElement` - кнопка закрытия баннера.

Методы:
`set total(total: number)` - сеттер - устанавливает описание с указанием списанной суммы.

#### Класс FormBase
Расширяет базовый класс Component с интерфейсом IOrderFormView. Отвечает за отображение основных элементов форм. 

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе все поля форм и кнопки сабмитов. На кнопки вешаем слушатели событий.

Поля класса:
`submitButton: HTMLButtonElement` - кнопка сабмита.
`formInputs: Record<string, HTMLInputElement>` - поля формы.
`formName: string` - имя формы.
`errors: Record<string, HTMLElement>` - ошибки при неверном заполнении.

Методы:
`get inputValues(): Record<string, string>` - геттер - получение введённых инпутов.
`set inputValues(data: Record<string, string>)` - сеттер - установка инпутов.
`set error(data: { field: string, value: string, validInformation: string })` - сеттер - установка ошибок.
`showError(input: string, errorMessage: string)` - показ ошибки.
`hideError(input: string)` - скрытие ошибки.
`get form(): HTMLElement` - получение формы.
`set valid(isValid: boolean)` - проверка корректности формы.


#### Класс FormPaymentAndAddress
Расширяет класс FormBase. Отвечает за отображение первого этапа заказа (выбор оплаты и доставка).

Конструктор: 
`constructor(container: HTMLElement): {}` - в конструкторе находим кнопки выбора оплаты. На кнопки вешаем слушатели выбора оплаты.

Поля класса:
`cardButton: HTMLButtonElement` - кнопка выбора оплаты картой.
`cashButton: HTMLButtonElement` - кнопка выбора оплаты наличными.

